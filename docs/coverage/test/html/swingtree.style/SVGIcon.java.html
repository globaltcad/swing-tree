<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SVGIcon.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">swing-tree</a> &gt; <a href="index.source.html" class="el_package">swingtree.style</a> &gt; <span class="el_source">SVGIcon.java</span></div><h1>SVGIcon.java</h1><pre class="source lang-java linenums">package swingtree.style;

import com.github.weisj.jsvg.SVGDocument;
import com.github.weisj.jsvg.attributes.ViewBox;
import com.github.weisj.jsvg.geometry.size.FloatSize;
import com.github.weisj.jsvg.parser.SVGLoader;
import swingtree.UI;

import javax.swing.ImageIcon;
import javax.swing.JComponent;
import java.awt.Graphics2D;
import java.awt.Image;
import java.awt.Insets;
import java.awt.geom.AffineTransform;
import java.awt.image.BufferedImage;
import java.net.URL;
import java.util.Optional;

/**
 *   A specialized {@link ImageIcon} subclass that allows you to use SVG based icon images in your UI.
 *   This in essence just a wrapper around the JSVG library, which renders SVG images into Java2D graphics API.
 */
public class SVGIcon extends ImageIcon
{
    /**
     *  This enum is used to specify how the SVG image should be scaled to fit the
     *  dimensions of the component that it is being rendered into
     *  using the {@link SVGIcon#paintIcon(java.awt.Component, java.awt.Graphics, int, int, int, int)} method.
     */
<span class="fc" id="L30">    public enum FitComponent {</span>
<span class="fc" id="L31">        WIDTH,</span>
<span class="fc" id="L32">        HEIGHT,</span>
<span class="fc" id="L33">        WIDTH_AND_HEIGHT,</span>
<span class="fc" id="L34">        MAX_DIM,</span>
<span class="fc" id="L35">        MIN_DIM</span>
    }

    private final SVGDocument svgDocument;

    private int _width;
    private int _height;

    private FitComponent _fitComponent;


    public SVGIcon( URL svgUrl, int width, int height, FitComponent fitComponent ) {
<span class="fc" id="L47">        super();</span>
<span class="fc" id="L48">        _width = width;</span>
<span class="fc" id="L49">        _height = height;</span>
<span class="fc" id="L50">        _fitComponent = fitComponent;</span>

<span class="fc" id="L52">        SVGDocument tempSVGDocument = null;</span>
        try {
<span class="fc" id="L54">            SVGLoader loader = new SVGLoader();</span>
<span class="fc" id="L55">            tempSVGDocument = loader.load(svgUrl);</span>
<span class="nc" id="L56">        } catch (Exception e) {</span>
<span class="nc" id="L57">            e.printStackTrace();</span>
<span class="fc" id="L58">        }</span>
<span class="fc" id="L59">        this.svgDocument = tempSVGDocument;</span>
<span class="fc" id="L60">    }</span>

    public SVGIcon( URL svgUrl, int width, int height ) {
<span class="fc" id="L63">        this(svgUrl, width, height, FitComponent.MIN_DIM);</span>
<span class="fc" id="L64">    }</span>

    public SVGIcon( String path, int width, int height ) {
<span class="nc" id="L67">        this(SVGIcon.class.getResource(path), width, height);</span>
<span class="nc" id="L68">    }</span>

<span class="nc" id="L70">    public SVGIcon( String path ) { this(path, -1, -1); }</span>

<span class="fc" id="L72">    public SVGIcon( URL svgUrl ) { this(svgUrl, -1, -1); }</span>


    @Override
<span class="fc" id="L76">    public int getIconWidth() { return _width; }</span>

<span class="nc" id="L78">    public void setIconWidth( int width ) { _width = width; }</span>

    @Override
<span class="fc" id="L81">    public int getIconHeight() { return _height; }</span>

<span class="nc" id="L83">    public void setIconHeight( int height ) { _height = height; }</span>

<span class="nc" id="L85">    public void setFitComponent( FitComponent fit ) { _fitComponent = fit; }</span>

<span class="nc" id="L87">    public FitComponent getFitComponent() { return _fitComponent; }</span>

    @Override
    public Image getImage() {
        // We create a new buffered image, render into it, and then return it.
<span class="nc" id="L92">        BufferedImage image = new BufferedImage(getIconWidth(), getIconHeight(), BufferedImage.TYPE_INT_ARGB);</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">        if ( svgDocument != null )</span>
<span class="nc" id="L94">            svgDocument.render(</span>
                    null,
<span class="nc" id="L96">                    image.createGraphics(),</span>
<span class="nc" id="L97">                    new ViewBox(0, 0, getIconWidth(), getIconHeight())</span>
                );

<span class="nc" id="L100">        return image;</span>
    }

    @Override
    public void setImage( Image image ) {
        // We don't support this.
<span class="nc" id="L106">    }</span>

    @Override
    public void paintIcon( java.awt.Component c, java.awt.Graphics g, int x, int y )
    {
<span class="nc bnc" id="L111" title="All 2 branches missed.">        if ( svgDocument == null )</span>
<span class="nc" id="L112">            return;</span>

<span class="nc bnc" id="L114" title="All 2 branches missed.">        Insets insets = Optional.ofNullable( c instanceof JComponent ? ((JComponent)c).getBorder() : null )</span>
<span class="nc" id="L115">                                .map( b -&gt; b.getBorderInsets(c) )</span>
<span class="nc" id="L116">                                .orElse(new Insets(0,0,0,0));</span>
<span class="nc" id="L117">        x = insets.left;</span>
<span class="nc" id="L118">        y = insets.top;</span>

<span class="nc" id="L120">        int width  = _width;</span>
<span class="nc" id="L121">        int height = _height;</span>

<span class="nc bnc" id="L123" title="All 2 branches missed.">        width  = width  &lt; 0 ? c.getWidth()  : width;</span>
<span class="nc bnc" id="L124" title="All 2 branches missed.">        height = height &lt; 0 ? c.getHeight() : height;</span>

<span class="nc" id="L126">        width  = width  - insets.right  - insets.left;</span>
<span class="nc" id="L127">        height = height - insets.bottom - insets.top;</span>

<span class="nc" id="L129">        paintIcon( c, g, x, y, width, height );</span>
<span class="nc" id="L130">    }</span>

    public void paintIcon( java.awt.Component c, java.awt.Graphics g, int x, int y, int width, int height )
    {
<span class="nc" id="L134">        Graphics2D g2d = (Graphics2D) g.create();</span>
<span class="nc bnc" id="L135" title="All 2 branches missed.">        boolean doAntiAliasing  = UI.scale() &lt; 1.5;</span>
<span class="nc bnc" id="L136" title="All 2 branches missed.">        boolean wasAntiAliasing = g2d.getRenderingHint( java.awt.RenderingHints.KEY_ANTIALIASING ) == java.awt.RenderingHints.VALUE_ANTIALIAS_ON;</span>
<span class="nc bnc" id="L137" title="All 4 branches missed.">        if (doAntiAliasing &amp;&amp; !wasAntiAliasing) {</span>
<span class="nc" id="L138">            g2d.setRenderingHint( java.awt.RenderingHints.KEY_ANTIALIASING, java.awt.RenderingHints.VALUE_ANTIALIAS_ON );</span>
        }

<span class="nc" id="L141">        FloatSize svgSize = svgDocument.size();</span>
<span class="nc bnc" id="L142" title="All 2 branches missed.">        float svgRefWidth  = ( svgSize.width  &gt; svgSize.height ? 1f : svgSize.width  / svgSize.height );</span>
<span class="nc bnc" id="L143" title="All 2 branches missed.">        float svgRefHeight = ( svgSize.height &gt; svgSize.width  ? 1f : svgSize.height / svgSize.width  );</span>
<span class="nc bnc" id="L144" title="All 2 branches missed.">        float imgRefWidth  = (     width      &gt;    height      ? 1f :  (float) width /   height       );</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">        float imgRefHeight = (     height     &gt;    width       ? 1f : (float) height /   width        );</span>

<span class="nc" id="L147">        float scaleX = imgRefWidth  / svgRefWidth;</span>
<span class="nc" id="L148">        float scaleY = imgRefHeight / svgRefHeight;</span>

<span class="nc bnc" id="L150" title="All 4 branches missed.">        if ( _fitComponent == FitComponent.MIN_DIM || _fitComponent == FitComponent.MAX_DIM ) {</span>
<span class="nc bnc" id="L151" title="All 2 branches missed.">            if ( width &lt; height )</span>
<span class="nc" id="L152">                scaleX = 1f;</span>
<span class="nc bnc" id="L153" title="All 2 branches missed.">            if ( height &lt; width )</span>
<span class="nc" id="L154">                scaleY = 1f;</span>
        }

<span class="nc bnc" id="L157" title="All 2 branches missed.">        if ( _fitComponent == FitComponent.WIDTH )</span>
<span class="nc" id="L158">            scaleX = 1f;</span>

<span class="nc bnc" id="L160" title="All 2 branches missed.">        if ( _fitComponent == FitComponent.HEIGHT )</span>
<span class="nc" id="L161">            scaleY = 1f;</span>

<span class="nc" id="L163">        ViewBox viewBox = new ViewBox(x, y, width, height);</span>
<span class="nc" id="L164">        float boxX      = viewBox.x  / scaleX;</span>
<span class="nc" id="L165">        float boxY      = viewBox.y  / scaleY;</span>
<span class="nc" id="L166">        float boxWidth  = viewBox.width  / scaleX;</span>
<span class="nc" id="L167">        float boxHeight = viewBox.height / scaleY;</span>
<span class="nc bnc" id="L168" title="All 2 branches missed.">        if ( _fitComponent == FitComponent.MAX_DIM ) {</span>
            // We now want to make sure that the
<span class="nc bnc" id="L170" title="All 2 branches missed.">            if ( boxWidth &lt; boxHeight ) {</span>
                // We find the scale factor of the heights between the two rectangles:
<span class="nc" id="L172">                float scaleHeight = ( viewBox.height / svgSize.height );</span>
                // We now want to scale the view box so that both have the same heights:
<span class="nc" id="L174">                float newWidth  = svgSize.width  * scaleHeight;</span>
<span class="nc" id="L175">                float newHeight = svgSize.height * scaleHeight;</span>
<span class="nc" id="L176">                float newX = viewBox.x + (viewBox.width - newWidth) / 2f;</span>
<span class="nc" id="L177">                float newY = viewBox.y;</span>
<span class="nc" id="L178">                viewBox = new ViewBox(newX, newY, newWidth, newHeight);</span>
<span class="nc" id="L179">            } else {</span>
                // We find the scale factor of the widths between the two rectangles:
<span class="nc" id="L181">                float scaleWidth = ( viewBox.width / svgSize.width );</span>
                // We now want to scale the view box so that both have the same widths:
<span class="nc" id="L183">                float newWidth  = svgSize.width  * scaleWidth;</span>
<span class="nc" id="L184">                float newHeight = svgSize.height * scaleWidth;</span>
<span class="nc" id="L185">                float newX = viewBox.x;</span>
<span class="nc" id="L186">                float newY = viewBox.y + (viewBox.height - newHeight) / 2f;</span>
<span class="nc" id="L187">                viewBox = new ViewBox(newX, newY, newWidth, newHeight);</span>
<span class="nc" id="L188">            }</span>
        }
        else
<span class="nc" id="L191">            viewBox = new ViewBox(boxX, boxY, boxWidth, boxHeight);</span>

<span class="nc" id="L193">        AffineTransform oldTransform = g2d.getTransform();</span>
<span class="nc" id="L194">        AffineTransform newTransform = new AffineTransform(oldTransform);</span>
<span class="nc" id="L195">        newTransform.scale(scaleX, scaleY);</span>

<span class="nc" id="L197">        g2d.setTransform(newTransform);</span>

        // We also have to scale x and y, this is because the SVGDocument does not
        // account for the scale of the transform with respect to the view box!
<span class="nc" id="L201">        svgDocument.render( (JComponent) c, g2d, viewBox );</span>

<span class="nc" id="L203">        g2d.setTransform(oldTransform);</span>

<span class="nc bnc" id="L205" title="All 4 branches missed.">        if (doAntiAliasing &amp;&amp; !wasAntiAliasing) {</span>
<span class="nc" id="L206">            g2d.setRenderingHint( java.awt.RenderingHints.KEY_ANTIALIASING, java.awt.RenderingHints.VALUE_ANTIALIAS_OFF );</span>
        }
<span class="nc" id="L208">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>