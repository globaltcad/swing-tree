<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SVGIcon.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">swing-tree</a> &gt; <a href="index.source.html" class="el_package">swingtree.style</a> &gt; <span class="el_source">SVGIcon.java</span></div><h1>SVGIcon.java</h1><pre class="source lang-java linenums">package swingtree.style;

import com.github.weisj.jsvg.SVGDocument;
import com.github.weisj.jsvg.attributes.ViewBox;
import com.github.weisj.jsvg.geometry.size.FloatSize;
import com.github.weisj.jsvg.parser.SVGLoader;
import org.slf4j.Logger;
import swingtree.UI;

import javax.swing.ImageIcon;
import javax.swing.JComponent;
import java.awt.Graphics2D;
import java.awt.Image;
import java.awt.Insets;
import java.awt.geom.AffineTransform;
import java.awt.image.BufferedImage;
import java.net.URL;
import java.util.Optional;

/**
 *   A specialized {@link ImageIcon} subclass that allows you to use SVG based icon images in your UI.
 *   This in essence just a wrapper around the JSVG library, which renders SVG images into Java2D graphics API.
 */
public class SVGIcon extends ImageIcon
{
<span class="fc" id="L26">    private static final Logger log = org.slf4j.LoggerFactory.getLogger(SVGIcon.class);</span>

    /**
     *  This enum is used to specify how the SVG image should be scaled to fit the
     *  dimensions of the component that it is being rendered into
     *  using the {@link SVGIcon#paintIcon(java.awt.Component, java.awt.Graphics, int, int, int, int)} method.
     */
<span class="fc" id="L33">    public enum FitComponent {</span>
<span class="fc" id="L34">        WIDTH,</span>
<span class="fc" id="L35">        HEIGHT,</span>
<span class="fc" id="L36">        WIDTH_AND_HEIGHT,</span>
<span class="fc" id="L37">        MAX_DIM,</span>
<span class="fc" id="L38">        MIN_DIM</span>
    }

    private final SVGDocument svgDocument;

    private int _width;
    private int _height;

    private FitComponent _fitComponent;


    public SVGIcon( URL svgUrl, int width, int height, FitComponent fitComponent ) {
<span class="fc" id="L50">        super();</span>
<span class="fc" id="L51">        _width = width;</span>
<span class="fc" id="L52">        _height = height;</span>
<span class="fc" id="L53">        _fitComponent = fitComponent;</span>

<span class="fc" id="L55">        SVGDocument tempSVGDocument = null;</span>
        try {
<span class="fc" id="L57">            SVGLoader loader = new SVGLoader();</span>
<span class="fc" id="L58">            tempSVGDocument = loader.load(svgUrl);</span>
<span class="nc" id="L59">        } catch (Exception e) {</span>
<span class="nc" id="L60">            log.error(&quot;Failed to load SVG document from URL: &quot; + svgUrl, e);</span>
<span class="fc" id="L61">        }</span>
<span class="fc" id="L62">        this.svgDocument = tempSVGDocument;</span>
<span class="fc" id="L63">    }</span>

    public SVGIcon( URL svgUrl, int width, int height ) {
<span class="fc" id="L66">        this(svgUrl, width, height, FitComponent.MIN_DIM);</span>
<span class="fc" id="L67">    }</span>

    public SVGIcon( String path, int width, int height ) {
<span class="nc" id="L70">        this(SVGIcon.class.getResource(path), width, height);</span>
<span class="nc" id="L71">    }</span>

<span class="nc" id="L73">    public SVGIcon( String path ) { this(path, -1, -1); }</span>

<span class="fc" id="L75">    public SVGIcon( URL svgUrl ) { this(svgUrl, -1, -1); }</span>


    @Override
<span class="fc" id="L79">    public int getIconWidth() { return _width; }</span>

<span class="nc" id="L81">    public void setIconWidth( int width ) { _width = width; }</span>

    @Override
<span class="fc" id="L84">    public int getIconHeight() { return _height; }</span>

<span class="nc" id="L86">    public void setIconHeight( int height ) { _height = height; }</span>

<span class="nc" id="L88">    public void setFitComponent( FitComponent fit ) { _fitComponent = fit; }</span>

<span class="nc" id="L90">    public FitComponent getFitComponent() { return _fitComponent; }</span>

    @Override
    public Image getImage() {
        // We create a new buffered image, render into it, and then return it.
<span class="nc" id="L95">        BufferedImage image = new BufferedImage(getIconWidth(), getIconHeight(), BufferedImage.TYPE_INT_ARGB);</span>
<span class="nc bnc" id="L96" title="All 2 branches missed.">        if ( svgDocument != null )</span>
<span class="nc" id="L97">            svgDocument.render(</span>
                    null,
<span class="nc" id="L99">                    image.createGraphics(),</span>
<span class="nc" id="L100">                    new ViewBox(0, 0, getIconWidth(), getIconHeight())</span>
                );

<span class="nc" id="L103">        return image;</span>
    }

    @Override
    public void setImage( Image image ) {
        // We don't support this.
<span class="nc" id="L109">    }</span>

    @Override
    public void paintIcon( java.awt.Component c, java.awt.Graphics g, int x, int y )
    {
<span class="nc bnc" id="L114" title="All 2 branches missed.">        if ( svgDocument == null )</span>
<span class="nc" id="L115">            return;</span>

<span class="nc bnc" id="L117" title="All 2 branches missed.">        Insets insets = Optional.ofNullable( c instanceof JComponent ? ((JComponent)c).getBorder() : null )</span>
<span class="nc" id="L118">                                .map( b -&gt; b.getBorderInsets(c) )</span>
<span class="nc" id="L119">                                .orElse(new Insets(0,0,0,0));</span>
<span class="nc" id="L120">        x = insets.left;</span>
<span class="nc" id="L121">        y = insets.top;</span>

<span class="nc" id="L123">        int width  = _width;</span>
<span class="nc" id="L124">        int height = _height;</span>

<span class="nc bnc" id="L126" title="All 2 branches missed.">        width  = width  &lt; 0 ? c.getWidth()  : width;</span>
<span class="nc bnc" id="L127" title="All 2 branches missed.">        height = height &lt; 0 ? c.getHeight() : height;</span>

<span class="nc" id="L129">        width  = width  - insets.right  - insets.left;</span>
<span class="nc" id="L130">        height = height - insets.bottom - insets.top;</span>

<span class="nc" id="L132">        paintIcon( c, g, x, y, width, height );</span>
<span class="nc" id="L133">    }</span>

    public void paintIcon( java.awt.Component c, java.awt.Graphics g, int x, int y, int width, int height )
    {
<span class="nc" id="L137">        Graphics2D g2d = (Graphics2D) g.create();</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">        boolean doAntiAliasing  = UI.scale() &lt; 1.5;</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">        boolean wasAntiAliasing = g2d.getRenderingHint( java.awt.RenderingHints.KEY_ANTIALIASING ) == java.awt.RenderingHints.VALUE_ANTIALIAS_ON;</span>
<span class="nc bnc" id="L140" title="All 4 branches missed.">        if (doAntiAliasing &amp;&amp; !wasAntiAliasing) {</span>
<span class="nc" id="L141">            g2d.setRenderingHint( java.awt.RenderingHints.KEY_ANTIALIASING, java.awt.RenderingHints.VALUE_ANTIALIAS_ON );</span>
        }

<span class="nc" id="L144">        FloatSize svgSize = svgDocument.size();</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">        float svgRefWidth  = ( svgSize.width  &gt; svgSize.height ? 1f : svgSize.width  / svgSize.height );</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">        float svgRefHeight = ( svgSize.height &gt; svgSize.width  ? 1f : svgSize.height / svgSize.width  );</span>
<span class="nc bnc" id="L147" title="All 2 branches missed.">        float imgRefWidth  = (     width      &gt;    height      ? 1f :  (float) width /   height       );</span>
<span class="nc bnc" id="L148" title="All 2 branches missed.">        float imgRefHeight = (     height     &gt;    width       ? 1f : (float) height /   width        );</span>

<span class="nc" id="L150">        float scaleX = imgRefWidth  / svgRefWidth;</span>
<span class="nc" id="L151">        float scaleY = imgRefHeight / svgRefHeight;</span>

<span class="nc bnc" id="L153" title="All 4 branches missed.">        if ( _fitComponent == FitComponent.MIN_DIM || _fitComponent == FitComponent.MAX_DIM ) {</span>
<span class="nc bnc" id="L154" title="All 2 branches missed.">            if ( width &lt; height )</span>
<span class="nc" id="L155">                scaleX = 1f;</span>
<span class="nc bnc" id="L156" title="All 2 branches missed.">            if ( height &lt; width )</span>
<span class="nc" id="L157">                scaleY = 1f;</span>
        }

<span class="nc bnc" id="L160" title="All 2 branches missed.">        if ( _fitComponent == FitComponent.WIDTH )</span>
<span class="nc" id="L161">            scaleX = 1f;</span>

<span class="nc bnc" id="L163" title="All 2 branches missed.">        if ( _fitComponent == FitComponent.HEIGHT )</span>
<span class="nc" id="L164">            scaleY = 1f;</span>

<span class="nc" id="L166">        ViewBox viewBox = new ViewBox(x, y, width, height);</span>
<span class="nc" id="L167">        float boxX      = viewBox.x  / scaleX;</span>
<span class="nc" id="L168">        float boxY      = viewBox.y  / scaleY;</span>
<span class="nc" id="L169">        float boxWidth  = viewBox.width  / scaleX;</span>
<span class="nc" id="L170">        float boxHeight = viewBox.height / scaleY;</span>
<span class="nc bnc" id="L171" title="All 2 branches missed.">        if ( _fitComponent == FitComponent.MAX_DIM ) {</span>
            // We now want to make sure that the
<span class="nc bnc" id="L173" title="All 2 branches missed.">            if ( boxWidth &lt; boxHeight ) {</span>
                // We find the scale factor of the heights between the two rectangles:
<span class="nc" id="L175">                float scaleHeight = ( viewBox.height / svgSize.height );</span>
                // We now want to scale the view box so that both have the same heights:
<span class="nc" id="L177">                float newWidth  = svgSize.width  * scaleHeight;</span>
<span class="nc" id="L178">                float newHeight = svgSize.height * scaleHeight;</span>
<span class="nc" id="L179">                float newX = viewBox.x + (viewBox.width - newWidth) / 2f;</span>
<span class="nc" id="L180">                float newY = viewBox.y;</span>
<span class="nc" id="L181">                viewBox = new ViewBox(newX, newY, newWidth, newHeight);</span>
<span class="nc" id="L182">            } else {</span>
                // We find the scale factor of the widths between the two rectangles:
<span class="nc" id="L184">                float scaleWidth = ( viewBox.width / svgSize.width );</span>
                // We now want to scale the view box so that both have the same widths:
<span class="nc" id="L186">                float newWidth  = svgSize.width  * scaleWidth;</span>
<span class="nc" id="L187">                float newHeight = svgSize.height * scaleWidth;</span>
<span class="nc" id="L188">                float newX = viewBox.x;</span>
<span class="nc" id="L189">                float newY = viewBox.y + (viewBox.height - newHeight) / 2f;</span>
<span class="nc" id="L190">                viewBox = new ViewBox(newX, newY, newWidth, newHeight);</span>
<span class="nc" id="L191">            }</span>
        }
        else
<span class="nc" id="L194">            viewBox = new ViewBox(boxX, boxY, boxWidth, boxHeight);</span>

<span class="nc" id="L196">        AffineTransform oldTransform = g2d.getTransform();</span>
<span class="nc" id="L197">        AffineTransform newTransform = new AffineTransform(oldTransform);</span>
<span class="nc" id="L198">        newTransform.scale(scaleX, scaleY);</span>

<span class="nc" id="L200">        g2d.setTransform(newTransform);</span>

        // We also have to scale x and y, this is because the SVGDocument does not
        // account for the scale of the transform with respect to the view box!
<span class="nc" id="L204">        svgDocument.render( (JComponent) c, g2d, viewBox );</span>

<span class="nc" id="L206">        g2d.setTransform(oldTransform);</span>

<span class="nc bnc" id="L208" title="All 4 branches missed.">        if (doAntiAliasing &amp;&amp; !wasAntiAliasing) {</span>
<span class="nc" id="L209">            g2d.setRenderingHint( java.awt.RenderingHints.KEY_ANTIALIASING, java.awt.RenderingHints.VALUE_ANTIALIAS_OFF );</span>
        }
<span class="nc" id="L211">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>