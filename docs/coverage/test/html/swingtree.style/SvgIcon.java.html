<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SvgIcon.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">swing-tree</a> &gt; <a href="index.source.html" class="el_package">swingtree.style</a> &gt; <span class="el_source">SvgIcon.java</span></div><h1>SvgIcon.java</h1><pre class="source lang-java linenums">package swingtree.style;

import com.github.weisj.jsvg.SVGDocument;
import com.github.weisj.jsvg.attributes.ViewBox;
import com.github.weisj.jsvg.geometry.size.FloatSize;
import com.github.weisj.jsvg.parser.SVGLoader;
import org.slf4j.Logger;
import swingtree.UI;

import javax.swing.ImageIcon;
import javax.swing.JComponent;
import javax.swing.border.Border;
import java.awt.Component;
import java.awt.Graphics2D;
import java.awt.Image;
import java.awt.Insets;
import java.awt.geom.AffineTransform;
import java.awt.image.BufferedImage;
import java.net.URL;
import java.util.Objects;
import java.util.Optional;

/**
 *   A specialized {@link ImageIcon} subclass that allows you to use SVG based icon images in your UI.
 *   This in essence just a wrapper around the JSVG library, which renders SVG images into Java2D graphics API.
 */
public final class SvgIcon extends ImageIcon
{
<span class="fc" id="L29">    private static final Logger log = org.slf4j.LoggerFactory.getLogger(SvgIcon.class);</span>
<span class="fc" id="L30">    private static final UI.FitComponent DEFAULT_FIT_COMPONENT = UI.FitComponent.MIN_DIM;</span>
<span class="fc" id="L31">    private static final UI.Placement    DEFAULT_PLACEMENT     = UI.Placement.UNDEFINED;</span>

    private final SVGDocument _svgDocument;

    private final int _width;
    private final int _height;

    private final UI.FitComponent _fitComponent;
    private final UI.Placement    _preferredPlacement;


    private SvgIcon(
        SVGDocument     svgDocument,
        int             width,
        int             height,
        UI.FitComponent fitComponent,
        UI.Placement    preferredPlacement
    ) {
<span class="fc" id="L49">        super();</span>
<span class="fc" id="L50">        _svgDocument        = svgDocument;</span>
<span class="fc" id="L51">        _width              = width;</span>
<span class="fc" id="L52">        _height             = height;</span>
<span class="fc" id="L53">        _fitComponent       = fitComponent;</span>
<span class="fc" id="L54">        _preferredPlacement = preferredPlacement;</span>
<span class="fc" id="L55">    }</span>

    public SvgIcon( SvgIcon icon ) {
<span class="nc" id="L58">        this(icon._svgDocument, icon._width, icon._height, icon._fitComponent, icon._preferredPlacement);</span>
<span class="nc" id="L59">    }</span>

    public SvgIcon( URL svgUrl, int width, int height, UI.FitComponent fitComponent, UI.Placement preferredPlacement ) {
<span class="nc" id="L62">        this(_loadSvgDocument(svgUrl), width, height, fitComponent, preferredPlacement);</span>
<span class="nc" id="L63">    }</span>

    public SvgIcon( URL svgUrl, int width, int height, UI.FitComponent fitComponent ) {
<span class="fc" id="L66">        this(_loadSvgDocument(svgUrl), width, height, fitComponent, DEFAULT_PLACEMENT);</span>
<span class="fc" id="L67">    }</span>

    public SvgIcon( URL svgUrl, int width, int height ) {
<span class="fc" id="L70">        this(svgUrl, width, height, DEFAULT_FIT_COMPONENT);</span>
<span class="fc" id="L71">    }</span>

    public SvgIcon( String path, int width, int height ) {
<span class="nc" id="L74">        this(SvgIcon.class.getResource(path), width, height);</span>
<span class="nc" id="L75">    }</span>

    public SvgIcon( String path ) {
<span class="nc" id="L78">        this(path, -1, -1);</span>
<span class="nc" id="L79">    }</span>

    public SvgIcon( URL svgUrl ) {
<span class="fc" id="L82">        this(svgUrl, -1, -1);</span>
<span class="fc" id="L83">    }</span>


    private static SVGDocument _loadSvgDocument( URL svgUrl ) {
<span class="fc" id="L87">        SVGDocument tempSVGDocument = null;</span>
        try {
<span class="fc" id="L89">            SVGLoader loader = new SVGLoader();</span>
<span class="fc" id="L90">            tempSVGDocument = loader.load(svgUrl);</span>
<span class="nc" id="L91">        } catch (Exception e) {</span>
<span class="nc" id="L92">            log.error(&quot;Failed to load SVG document from URL: &quot; + svgUrl, e);</span>
<span class="fc" id="L93">        }</span>
<span class="fc" id="L94">        return tempSVGDocument;</span>
    }


    /**
     * @return The width of the icon, or -1 if the icon should be rendered according
     *         to the width of a given component or the width of the SVG document itself.
     */
    @Override
    public int getIconWidth() {
<span class="fc" id="L104">        return _width;</span>
    }

    /**
     * @param width The width of the icon, or -1 if the icon should be rendered according
     *              to the width of a given component or the width of the SVG document itself.
     * @return A new {@link SvgIcon} with the given width.
     *        If the width is -1, the icon will be rendered according to the width of a given component
     *        or the width of the SVG document itself.
     */
    public SvgIcon withIconWidth( int width ) {
<span class="pc bpc" id="L115" title="1 of 2 branches missed.">        if ( width == _width )</span>
<span class="nc" id="L116">            return this;</span>
<span class="fc" id="L117">        return new SvgIcon(_svgDocument, width, _height, _fitComponent, _preferredPlacement);</span>
    }

    /**
     * @return A new {@link SvgIcon} with the given width and height.
     *        If the width or height is -1, the icon will be rendered according to the width or height of a given component
     *        or the width or height of the SVG document itself.
     */
    @Override
    public int getIconHeight() {
<span class="fc" id="L127">        return _height;</span>
    }

    /**
     * @param height The height of the icon, or -1 if the icon should be rendered according
     *               to the height of a given component or the height of the SVG document itself.
     * @return A new {@link SvgIcon} with the given height.
     *        If the height is -1, the icon will be rendered according to the height of a given component
     *        or the height of the SVG document itself.
     */
    public SvgIcon withIconHeight( int height ) {
<span class="pc bpc" id="L138" title="1 of 2 branches missed.">        if ( height == _height )</span>
<span class="nc" id="L139">            return this;</span>
<span class="fc" id="L140">        return new SvgIcon(_svgDocument, _width, height, _fitComponent, _preferredPlacement);</span>
    }

    /**
     * @param width The width of the icon, or -1 if the icon should be rendered according
     *              to the width of a given component or the width of the SVG document itself.
     * @param height The height of the icon, or -1 if the icon should be rendered according
     *               to the height of a given component or the height of the SVG document itself.
     * @return A new {@link SvgIcon} with the given width and height.
     *        If the width or height is -1, the icon will be rendered according to the width or height of a given component
     *        or the width or height of the SVG document itself.
     */
    public SvgIcon withIconSize( int width, int height ) {
<span class="nc bnc" id="L153" title="All 4 branches missed.">        if ( width == _width &amp;&amp; height == _height )</span>
<span class="nc" id="L154">            return this;</span>
<span class="nc" id="L155">        return new SvgIcon(_svgDocument, width, height, _fitComponent, _preferredPlacement);</span>
    }

    /**
     * @return The size of the SVG document in the form of a {@link FloatSize},
     *         a subclass of {@link java.awt.geom.Dimension2D}.
     */
    public FloatSize getSvgSize() {
<span class="fc" id="L163">        return _svgDocument.size();</span>
    }

    /**
     * @return The {@link UI.FitComponent} that determines if and how the icon should be fitted into a
     *         any given component (see {@link #paintIcon(Component, java.awt.Graphics, int, int, int, int)}).
     */
<span class="nc" id="L170">    public UI.FitComponent getFitComponent() { return _fitComponent; }</span>

    /**
     * @param fit The {@link UI.FitComponent} that determines if and how the icon should be fitted into a
     *            any given component (see {@link #paintIcon(Component, java.awt.Graphics, int, int, int, int)}).
     * @return A new {@link SvgIcon} with the given {@link UI.FitComponent} policy.
     */
    public SvgIcon withFitComponent( UI.FitComponent fit ) {
<span class="fc" id="L178">        Objects.requireNonNull(fit);</span>
<span class="pc bpc" id="L179" title="1 of 2 branches missed.">        if ( fit == _fitComponent )</span>
<span class="nc" id="L180">            return this;</span>
<span class="fc" id="L181">        return new SvgIcon(_svgDocument, _width, _height, fit, _preferredPlacement);</span>
    }

    /**
     * @return The {@link UI.Placement} that determines where the icon should be placed within a component
     *         (see {@link #paintIcon(Component, java.awt.Graphics, int, int, int, int)}).
     */
<span class="fc" id="L188">    public UI.Placement getPreferredPlacement() { return _preferredPlacement; }</span>

    /**
     * @param placement The {@link UI.Placement} that determines where the icon should be placed within a component
     *                  (see {@link #paintIcon(Component, java.awt.Graphics, int, int, int, int)}).
     * @return A new {@link SvgIcon} with the given {@link UI.Placement} policy.
     */
    public SvgIcon withPreferredPlacement( UI.Placement placement ) {
<span class="fc" id="L196">        Objects.requireNonNull(placement);</span>
<span class="pc bpc" id="L197" title="1 of 2 branches missed.">        if ( placement == _preferredPlacement )</span>
<span class="nc" id="L198">            return this;</span>
<span class="fc" id="L199">        return new SvgIcon(_svgDocument, _width, _height, _fitComponent, placement);</span>
    }

    /**
     *  Creates a new {@link Image} from the SVG document.
     * @return A new {@link Image} where the SVG document has been rendered into.
     */
    @Override
    public Image getImage() {
<span class="nc" id="L208">        int width  = getIconWidth();</span>
<span class="nc" id="L209">        int height = getIconHeight();</span>

<span class="nc bnc" id="L211" title="All 2 branches missed.">        if ( _svgDocument != null ) {</span>
<span class="nc bnc" id="L212" title="All 2 branches missed.">            if (width &lt; 0)</span>
<span class="nc" id="L213">                width = (int) _svgDocument.size().width;</span>
<span class="nc bnc" id="L214" title="All 2 branches missed.">            if (height &lt; 0)</span>
<span class="nc" id="L215">                height = (int) _svgDocument.size().height;</span>
        }

        // We create a new buffered image, render into it, and then return it.
<span class="nc" id="L219">        BufferedImage image = new BufferedImage(width, height, BufferedImage.TYPE_INT_ARGB);</span>
<span class="nc bnc" id="L220" title="All 2 branches missed.">        if ( _svgDocument != null )</span>
<span class="nc" id="L221">            _svgDocument.render(</span>
                    null,
<span class="nc" id="L223">                    image.createGraphics(),</span>
                    new ViewBox(0, 0, width, height)
                );

<span class="nc" id="L227">        return image;</span>
    }

    /**
     *  We don't support this. An SVG document is not really an image, it's a vector graphic.
     *  Extending {@link ImageIcon} is just for compatibility reasons...
     */
    @Override
    public void setImage( Image image ) {
        // We don't support this.
<span class="nc" id="L237">    }</span>

    /**
     * @param c The component to render the icon into.
     * @param g the graphics context
     * @param x the X coordinate of the icon's top-left corner
     * @param y the Y coordinate of the icon's top-left corner
     */
    @Override
    public void paintIcon( java.awt.Component c, java.awt.Graphics g, int x, int y )
    {
<span class="pc bpc" id="L248" title="1 of 2 branches missed.">        if ( _svgDocument == null )</span>
<span class="nc" id="L249">            return;</span>

<span class="pc bpc" id="L251" title="1 of 2 branches missed.">        Insets insets = Optional.ofNullable( c instanceof JComponent ? ((JComponent)c).getBorder() : null )</span>
<span class="fc" id="L252">                                .map( b -&gt; {</span>
                                    try {
<span class="fc" id="L254">                                        return _determineInsetsForBorder(b, c);</span>
<span class="nc" id="L255">                                    } catch (Exception e) {</span>
<span class="nc" id="L256">                                        return new Insets(0,0,0,0);</span>
                                    }
                                })
<span class="fc" id="L259">                                .orElse(new Insets(0,0,0,0));</span>

<span class="fc" id="L261">        UI.Placement preferredPlacement = _preferredPlacement;</span>

<span class="pc bpc" id="L263" title="2 of 4 branches missed.">        if ( preferredPlacement == UI.Placement.UNDEFINED &amp;&amp; c instanceof JComponent )</span>
<span class="fc" id="L264">            preferredPlacement = ComponentExtension.from((JComponent) c).preferredIconPlacement();</span>

<span class="fc" id="L266">        int deltaX = 0;</span>
<span class="fc" id="L267">        int deltaY = 0;</span>

<span class="fc bfc" id="L269" title="All 2 branches covered.">        if ( _width &gt;= 0 ) {</span>
<span class="fc" id="L270">            deltaX += Math.max(0, x - insets.left);</span>
<span class="fc" id="L271">            x = Math.max(x, insets.left);</span>
        }
        else
<span class="fc" id="L274">            x = insets.left;</span>

<span class="fc bfc" id="L276" title="All 2 branches covered.">        if ( _height &gt;= 0 ) {</span>
<span class="fc" id="L277">            deltaY += Math.max(0, y - insets.top);</span>
<span class="fc" id="L278">            y = Math.max(y, insets.top);</span>
        }
        else
<span class="fc" id="L281">            y = insets.top;</span>

<span class="fc" id="L283">        int width  = c.getWidth();</span>
<span class="fc" id="L284">        int height = c.getHeight();</span>

<span class="fc" id="L286">        width  = width  - insets.right  - insets.left - deltaX;</span>
<span class="fc" id="L287">        height = height - insets.bottom - insets.top  - deltaY;</span>

<span class="pc bpc" id="L289" title="1 of 2 branches missed.">        if ( width  &lt;= 0 ) {</span>
<span class="nc" id="L290">            int smaller = (int) Math.floor( width / 2.0 );</span>
<span class="nc" id="L291">            int larger  = (int) Math.ceil(  width / 2.0 );</span>
<span class="nc" id="L292">            x += smaller;</span>
<span class="nc" id="L293">            width = ( larger - smaller );</span>
        }
<span class="pc bpc" id="L295" title="1 of 2 branches missed.">        if ( height &lt;= 0 ) {</span>
<span class="nc" id="L296">            int smaller = (int) Math.floor( height / 2.0 );</span>
<span class="nc" id="L297">            int larger  = (int) Math.ceil(  height / 2.0 );</span>
<span class="nc" id="L298">            y += smaller;</span>
<span class="nc" id="L299">            height = ( larger - smaller );</span>
        }

<span class="fc" id="L302">        _paintIcon( c, g, x, y, width, height, preferredPlacement );</span>
<span class="fc" id="L303">    }</span>

    private Insets _determineInsetsForBorder( Border b, Component c )
    {
<span class="pc bpc" id="L307" title="1 of 2 branches missed.">        if ( b == null )</span>
<span class="nc" id="L308">            return new Insets(0,0,0,0);</span>

<span class="fc bfc" id="L310" title="All 2 branches covered.">        if ( b instanceof StyleAndAnimationBorder )</span>
<span class="fc" id="L311">            return ((StyleAndAnimationBorder&lt;?&gt;)b).getFullPaddingInsets();</span>

        // Compound border
<span class="pc bpc" id="L314" title="1 of 2 branches missed.">        if ( b instanceof javax.swing.border.CompoundBorder ) {</span>
<span class="nc" id="L315">            javax.swing.border.CompoundBorder cb = (javax.swing.border.CompoundBorder) b;</span>
<span class="nc" id="L316">            return cb.getOutsideBorder().getBorderInsets(c);</span>
        }

        try {
<span class="fc" id="L320">            return b.getBorderInsets(c);</span>
<span class="nc" id="L321">        } catch (Exception e) {</span>
            // Ignore
        }
<span class="nc" id="L324">        return new Insets(0,0,0,0);</span>
    }

    public void paintIcon(
            final java.awt.Component c,
            final java.awt.Graphics g,
            int x,
            int y,
            int width,
            int height
    ) {
<span class="fc" id="L335">        _paintIcon( c, g, x, y, width, height, _preferredPlacement );</span>
<span class="fc" id="L336">    }</span>

    private void _paintIcon(
        final java.awt.Component c,
        final java.awt.Graphics g,
        int x,
        int y,
        int width,
        int height,
        UI.Placement preferredPlacement
    ) {
<span class="pc bpc" id="L347" title="1 of 2 branches missed.">        if ( _svgDocument == null )</span>
<span class="nc" id="L348">            return;</span>

<span class="pc bpc" id="L350" title="1 of 2 branches missed.">        width  = ( width  &lt; 0 ? getIconWidth()  : width  );</span>
<span class="pc bpc" id="L351" title="1 of 2 branches missed.">        height = ( height &lt; 0 ? getIconHeight() : height );</span>

<span class="fc" id="L353">        Graphics2D g2d = (Graphics2D) g.create();</span>

<span class="fc" id="L355">        FloatSize svgSize = _svgDocument.size();</span>
<span class="pc bpc" id="L356" title="1 of 2 branches missed.">        float svgRefWidth  = ( svgSize.width  &gt; svgSize.height ? 1f : svgSize.width  / svgSize.height );</span>
<span class="pc bpc" id="L357" title="1 of 2 branches missed.">        float svgRefHeight = ( svgSize.height &gt; svgSize.width  ? 1f : svgSize.height / svgSize.width  );</span>
<span class="fc bfc" id="L358" title="All 2 branches covered.">        float imgRefWidth  = (     width      &gt;=   height      ? 1f :  (float) width /   height       );</span>
<span class="fc bfc" id="L359" title="All 2 branches covered.">        float imgRefHeight = (     height     &gt;=   width       ? 1f : (float) height /   width        );</span>

<span class="fc" id="L361">        float scaleX = imgRefWidth  / svgRefWidth;</span>
<span class="fc" id="L362">        float scaleY = imgRefHeight / svgRefHeight;</span>

<span class="pc bpc" id="L364" title="1 of 4 branches missed.">        if ( _fitComponent == UI.FitComponent.MIN_DIM || _fitComponent == UI.FitComponent.MAX_DIM ) {</span>
<span class="pc bpc" id="L365" title="1 of 2 branches missed.">            if ( width &lt; height )</span>
<span class="nc" id="L366">                scaleX = 1f;</span>
<span class="fc bfc" id="L367" title="All 2 branches covered.">            if ( height &lt; width )</span>
<span class="fc" id="L368">                scaleY = 1f;</span>
        }

<span class="fc bfc" id="L371" title="All 2 branches covered.">        if ( _fitComponent == UI.FitComponent.WIDTH )</span>
<span class="fc" id="L372">            scaleX = 1f;</span>

<span class="fc bfc" id="L374" title="All 2 branches covered.">        if ( _fitComponent == UI.FitComponent.HEIGHT )</span>
<span class="fc" id="L375">            scaleY = 1f;</span>

<span class="fc" id="L377">        ViewBox viewBox = new ViewBox(x, y, width, height);</span>
<span class="fc" id="L378">        float boxX      = viewBox.x  / scaleX;</span>
<span class="fc" id="L379">        float boxY      = viewBox.y  / scaleY;</span>
<span class="fc" id="L380">        float boxWidth  = viewBox.width  / scaleX;</span>
<span class="fc" id="L381">        float boxHeight = viewBox.height / scaleY;</span>
<span class="pc bpc" id="L382" title="1 of 2 branches missed.">        if ( _fitComponent == UI.FitComponent.MAX_DIM ) {</span>
            // We now want to make sure that the
<span class="nc bnc" id="L384" title="All 2 branches missed.">            if ( boxWidth &lt; boxHeight ) {</span>
                // We find the scale factor of the heights between the two rectangles:
<span class="nc" id="L386">                float scaleHeight = ( viewBox.height / svgSize.height );</span>
                // We now want to scale the view box so that both have the same heights:
<span class="nc" id="L388">                float newWidth  = svgSize.width  * scaleHeight;</span>
<span class="nc" id="L389">                float newHeight = svgSize.height * scaleHeight;</span>
<span class="nc" id="L390">                float newX = viewBox.x + (viewBox.width - newWidth) / 2f;</span>
<span class="nc" id="L391">                float newY = viewBox.y;</span>
<span class="nc" id="L392">                viewBox = new ViewBox(newX, newY, newWidth, newHeight);</span>
<span class="nc" id="L393">            } else {</span>
                // We find the scale factor of the widths between the two rectangles:
<span class="nc" id="L395">                float scaleWidth = ( viewBox.width / svgSize.width );</span>
                // We now want to scale the view box so that both have the same widths:
<span class="nc" id="L397">                float newWidth  = svgSize.width  * scaleWidth;</span>
<span class="nc" id="L398">                float newHeight = svgSize.height * scaleWidth;</span>
<span class="nc" id="L399">                float newX = viewBox.x;</span>
<span class="nc" id="L400">                float newY = viewBox.y + (viewBox.height - newHeight) / 2f;</span>
<span class="nc" id="L401">                viewBox = new ViewBox(newX, newY, newWidth, newHeight);</span>
<span class="nc" id="L402">            }</span>
        }
        else
<span class="fc" id="L405">            viewBox = new ViewBox(boxX, boxY, boxWidth, boxHeight);</span>

<span class="fc bfc" id="L407" title="All 2 branches covered.">        if ( _fitComponent == UI.FitComponent.NO ) {</span>
<span class="pc bpc" id="L408" title="1 of 2 branches missed.">            width   = _width  &gt;= 0 ? _width  : (int) svgSize.width;</span>
<span class="pc bpc" id="L409" title="1 of 2 branches missed.">            height  = _height &gt;= 0 ? _height : (int) svgSize.height;</span>
<span class="fc" id="L410">            viewBox = new ViewBox( x, y, width, height );</span>
        }

        // Let's check if the view box exists:
<span class="pc bpc" id="L414" title="2 of 4 branches missed.">        if ( viewBox.width &lt;= 0 || viewBox.height &lt;= 0 )</span>
<span class="nc" id="L415">            return;</span>

        // Also let's check if the view box has valid values:
<span class="pc bpc" id="L418" title="4 of 8 branches missed.">        if ( Float.isNaN(viewBox.x) || Float.isNaN(viewBox.y) || Float.isNaN(viewBox.width) || Float.isNaN(viewBox.height) )</span>
<span class="nc" id="L419">            return;</span>

        // Let's make sure the view box has the correct dimension ratio:
<span class="fc" id="L422">        float viewBoxRatio = _svgDocument.size().width / _svgDocument.size().height;</span>
<span class="fc" id="L423">        float boxRatio     =      viewBox.width        /      viewBox.height;</span>
<span class="fc bfc" id="L424" title="All 2 branches covered.">        if ( boxRatio &gt; viewBoxRatio ) {</span>
            // The view box is too wide, we need to make it narrower:
<span class="fc" id="L426">            float newWidth = viewBox.height * viewBoxRatio;</span>
<span class="fc" id="L427">            viewBox = new ViewBox( viewBox.x + (viewBox.width - newWidth) / 2f, viewBox.y, newWidth, viewBox.height );</span>
        }
<span class="pc bpc" id="L429" title="1 of 2 branches missed.">        if ( boxRatio &lt; viewBoxRatio ) {</span>
            // The view box is too tall, we need to make it shorter:
<span class="nc" id="L431">            float newHeight = viewBox.width / viewBoxRatio;</span>
<span class="nc" id="L432">            viewBox = new ViewBox( viewBox.x, viewBox.y + (viewBox.height - newHeight) / 2f, viewBox.width, newHeight );</span>
        }

        /*
            Before we do the actual rendering we first check if there
            is a preferred placement that is not the center.
            If that is the case we move the view box accordingly.
         */
<span class="pc bpc" id="L440" title="1 of 4 branches missed.">        if ( preferredPlacement != UI.Placement.CENTER &amp;&amp; preferredPlacement != UI.Placement.UNDEFINED ) {</span>
            // First we correct if the component area is smaller than the view box:
<span class="nc" id="L442">            width += (int) Math.max(0, ( viewBox.x + viewBox.width ) - ( x + width ) );</span>
<span class="nc" id="L443">            width += (int) Math.max(0, x - viewBox.x );</span>
<span class="nc" id="L444">            x = (int) Math.min(x, viewBox.x);</span>
<span class="nc" id="L445">            height += (int) Math.max(0, ( viewBox.y + viewBox.height ) - ( y + height ) );</span>
<span class="nc" id="L446">            height += (int) Math.max(0, y - viewBox.y );</span>
<span class="nc" id="L447">            y = (int) Math.min(y, viewBox.y);</span>

<span class="nc bnc" id="L449" title="All 9 branches missed.">            switch ( preferredPlacement ) {</span>
                case TOP_LEFT:
<span class="nc" id="L451">                    viewBox = new ViewBox( x, y, viewBox.width, viewBox.height );</span>
<span class="nc" id="L452">                    break;</span>
                case TOP_RIGHT:
<span class="nc" id="L454">                    viewBox = new ViewBox( x + width - viewBox.width, y, viewBox.width, viewBox.height );</span>
<span class="nc" id="L455">                    break;</span>
                case BOTTOM_LEFT:
<span class="nc" id="L457">                    viewBox = new ViewBox( x, y + height - viewBox.height, viewBox.width, viewBox.height );</span>
<span class="nc" id="L458">                    break;</span>
                case BOTTOM_RIGHT:
<span class="nc" id="L460">                    viewBox = new ViewBox( x + width - viewBox.width, y + height - viewBox.height, viewBox.width, viewBox.height );</span>
<span class="nc" id="L461">                    break;</span>
                case TOP:
<span class="nc" id="L463">                    viewBox = new ViewBox( x + (width - viewBox.width) / 2f, y, viewBox.width, viewBox.height );</span>
<span class="nc" id="L464">                    break;</span>
                case BOTTOM:
<span class="nc" id="L466">                    viewBox = new ViewBox( x + (width - viewBox.width) / 2f, y + height - viewBox.height, viewBox.width, viewBox.height );</span>
<span class="nc" id="L467">                    break;</span>
                case LEFT:
<span class="nc" id="L469">                    viewBox = new ViewBox( x, y + (height - viewBox.height) / 2f, viewBox.width, viewBox.height );</span>
<span class="nc" id="L470">                    break;</span>
                case RIGHT:
<span class="nc" id="L472">                    viewBox = new ViewBox( x + width - viewBox.width, y + (height - viewBox.height) / 2f, viewBox.width, viewBox.height );</span>
                    break;
            }
        }

        // Now onto the actual rendering:

<span class="fc" id="L479">        boolean doAntiAliasing  = StylePainter.DO_ANTIALIASING();</span>
<span class="fc bfc" id="L480" title="All 2 branches covered.">        boolean wasAntiAliasing = g2d.getRenderingHint( java.awt.RenderingHints.KEY_ANTIALIASING ) == java.awt.RenderingHints.VALUE_ANTIALIAS_ON;</span>
<span class="fc bfc" id="L481" title="All 4 branches covered.">        if ( doAntiAliasing &amp;&amp; !wasAntiAliasing )</span>
<span class="fc" id="L482">            g2d.setRenderingHint( java.awt.RenderingHints.KEY_ANTIALIASING, java.awt.RenderingHints.VALUE_ANTIALIAS_ON );</span>

<span class="fc" id="L484">        AffineTransform oldTransform = g2d.getTransform();</span>
<span class="fc" id="L485">        AffineTransform newTransform = new AffineTransform(oldTransform);</span>
<span class="fc" id="L486">        newTransform.scale(scaleX, scaleY);</span>

<span class="fc" id="L488">        g2d.setTransform(newTransform);</span>

        try {
            // We also have to scale x and y, this is because the SVGDocument does not
            // account for the scale of the transform with respect to the view box!
<span class="fc" id="L493">            _svgDocument.render((JComponent) c, g2d, viewBox);</span>
<span class="nc" id="L494">        } catch (Exception e) {</span>
<span class="nc" id="L495">            log.warn(&quot;Failed to render SVG document: &quot; + _svgDocument, e);</span>
<span class="fc" id="L496">        }</span>

<span class="fc" id="L498">        g2d.setTransform(oldTransform);</span>

<span class="fc bfc" id="L500" title="All 4 branches covered.">        if ( doAntiAliasing &amp;&amp; !wasAntiAliasing )</span>
<span class="fc" id="L501">            g2d.setRenderingHint( java.awt.RenderingHints.KEY_ANTIALIASING, java.awt.RenderingHints.VALUE_ANTIALIAS_OFF );</span>
<span class="fc" id="L502">    }</span>

    @Override
    public int hashCode() {
<span class="nc" id="L506">        return Objects.hash(_svgDocument, _width, _height, _fitComponent, _preferredPlacement);</span>
    }

    @Override
    public boolean equals( Object obj ) {
<span class="pc bpc" id="L511" title="1 of 2 branches missed.">        if ( obj == null ) return false;</span>
<span class="nc bnc" id="L512" title="All 2 branches missed.">        if ( obj == this ) return true;</span>
<span class="nc bnc" id="L513" title="All 2 branches missed.">        if ( obj.getClass() != getClass() ) return false;</span>
<span class="nc" id="L514">        SvgIcon rhs = (SvgIcon) obj;</span>
<span class="nc bnc" id="L515" title="All 2 branches missed.">        return Objects.equals(_svgDocument,        rhs._svgDocument)  &amp;&amp;</span>
<span class="nc bnc" id="L516" title="All 2 branches missed.">               Objects.equals(_width,              rhs._width)        &amp;&amp;</span>
<span class="nc bnc" id="L517" title="All 2 branches missed.">               Objects.equals(_height,             rhs._height)       &amp;&amp;</span>
<span class="nc bnc" id="L518" title="All 2 branches missed.">               Objects.equals(_fitComponent,       rhs._fitComponent) &amp;&amp;</span>
<span class="nc bnc" id="L519" title="All 2 branches missed.">               Objects.equals(_preferredPlacement, rhs._preferredPlacement);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>