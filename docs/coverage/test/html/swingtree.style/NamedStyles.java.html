<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>NamedStyles.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">swing-tree</a> &gt; <a href="index.source.html" class="el_package">swingtree.style</a> &gt; <span class="el_source">NamedStyles.java</span></div><h1>NamedStyles.java</h1><pre class="source lang-java linenums">package swingtree.style;

import java.util.*;
import java.util.function.Function;
import java.util.function.Predicate;
import java.util.stream.Collectors;
import java.util.stream.Stream;

/**
 *  An immutable value container that stores {@link NamedStyle} instances
 *  representing a mapping of unique string names to styles of type {@link S}.
 *  The {@link NamedStyle} instances are stored in an array and can be accessed
 *  by their unique name.
 *  Yes, this class could have been a linked hashmap or treemap
 *  however, we do not expect the existence of more than a handful
 *  of named styles in a {@link Style} instance which is why we chose
 *  to use an array instead as it is more memory as well as CPU efficient
 *  to just iterate over a few array elements than to use a hashmap or treemap.
 *
 * @param &lt;S&gt; The type of the style.
 */
class NamedStyles&lt;S&gt;
{
<span class="fc" id="L24">    private static final NamedStyles&lt;?&gt; EMPTY = new NamedStyles&lt;&gt;();</span>

<span class="fc" id="L26">    static &lt;S&gt; NamedStyles&lt;S&gt; of( NamedStyle&lt;S&gt; defaultStyle ) { return new NamedStyles&lt;&gt;( defaultStyle ); }</span>

<span class="fc" id="L28">    static &lt;S&gt; NamedStyles&lt;S&gt; empty() { return (NamedStyles&lt;S&gt;) EMPTY; }</span>

    private final NamedStyle&lt;S&gt;[] _styles;

    @SafeVarargs
<span class="fc" id="L33">    private NamedStyles( NamedStyle&lt;S&gt;... styles ) {</span>
<span class="fc" id="L34">        _styles = Objects.requireNonNull(styles);</span>
        // No nll entries:
<span class="fc bfc" id="L36" title="All 2 branches covered.">        for ( NamedStyle&lt;S&gt; style : styles )</span>
<span class="fc" id="L37">            Objects.requireNonNull(style);</span>

        // No duplicate names:
<span class="fc" id="L40">        Set&lt;String&gt; names = new HashSet&lt;&gt;(styles.length * 2);</span>
<span class="fc bfc" id="L41" title="All 2 branches covered.">        for ( NamedStyle&lt;S&gt; style : styles )</span>
<span class="pc bpc" id="L42" title="1 of 2 branches missed.">            if ( !names.add(style.name()) )</span>
<span class="nc" id="L43">                throw new IllegalArgumentException(&quot;Duplicate style name: &quot; + style.name());</span>
<span class="fc" id="L44">    }</span>

<span class="fc" id="L46">    public int size() { return _styles.length; }</span>

<span class="fc" id="L48">    public List&lt;NamedStyle&lt;S&gt;&gt; namedStyles() { return Collections.unmodifiableList(Arrays.asList(_styles)); }</span>

    public Stream&lt;S&gt; stylesStream() {
<span class="fc" id="L51">        return namedStyles()</span>
<span class="fc" id="L52">                .stream()</span>
<span class="fc" id="L53">                .map(NamedStyle::style);</span>
    }

    public NamedStyles&lt;S&gt; withNamedStyle( String name, S style ) {
<span class="fc" id="L57">        Objects.requireNonNull(name);</span>
<span class="fc" id="L58">        Objects.requireNonNull(style);</span>

<span class="fc" id="L60">        int foundIndex = _findNamedStyle(name);</span>

<span class="fc bfc" id="L62" title="All 2 branches covered.">        if ( foundIndex == -1 ) {</span>
<span class="fc" id="L63">            NamedStyle&lt;S&gt;[] styles = Arrays.copyOf(_styles, _styles.length + 1);</span>
<span class="fc" id="L64">            styles[styles.length - 1] = NamedStyle.of(name, style);</span>
<span class="fc" id="L65">            return new NamedStyles&lt;&gt;(styles);</span>
        }

<span class="fc" id="L68">        NamedStyle&lt;S&gt;[] styles = Arrays.copyOf(_styles, _styles.length);</span>
<span class="fc" id="L69">        styles[foundIndex] = NamedStyle.of(name, style);</span>
<span class="fc" id="L70">        return new NamedStyles&lt;&gt;(styles);</span>
    }

    public NamedStyles&lt;S&gt; mapStyles( Function&lt;S,S&gt; f ) {
<span class="fc" id="L74">        Objects.requireNonNull(f);</span>

<span class="fc" id="L76">        NamedStyle&lt;S&gt;[] styles = Arrays.copyOf(_styles, _styles.length);</span>
<span class="fc bfc" id="L77" title="All 2 branches covered.">        for ( int i = 0; i &lt; styles.length; i++ )</span>
<span class="fc" id="L78">            styles[i] = NamedStyle.of(styles[i].name(), f.apply(styles[i].style()));</span>

<span class="fc" id="L80">        return new NamedStyles&lt;&gt;(styles);</span>
    }

    private int _findNamedStyle( String name ) {
<span class="fc bfc" id="L84" title="All 2 branches covered.">        for ( int i = 0; i &lt; _styles.length; i++ ) {</span>
<span class="fc bfc" id="L85" title="All 2 branches covered.">            if ( _styles[i].name().equals(name) )</span>
<span class="fc" id="L86">                return i;</span>
        }
<span class="fc" id="L88">        return -1;</span>
    }

    public S get( String name ) {
<span class="fc" id="L92">        Objects.requireNonNull(name);</span>

<span class="fc" id="L94">        int foundIndex = _findNamedStyle(name);</span>

<span class="fc bfc" id="L96" title="All 2 branches covered.">        if ( foundIndex == -1 )</span>
<span class="fc" id="L97">            return null;</span>

<span class="fc" id="L99">        return _styles[foundIndex].style();</span>
    }

    public Optional&lt;S&gt; style( String name ) {
<span class="fc" id="L103">        Objects.requireNonNull(name);</span>
<span class="fc" id="L104">        return Optional.ofNullable(get(name));</span>
    }

    public List&lt;S&gt; sortedByNamesAndFilteredBy( Predicate&lt;S&gt; filter ) {
<span class="fc" id="L108">        return Collections.unmodifiableList(</span>
<span class="fc" id="L109">                    namedStyles()</span>
<span class="fc" id="L110">                    .stream()</span>
<span class="fc" id="L111">                    .sorted(Comparator.comparing(NamedStyle::name))</span>
<span class="fc" id="L112">                    .map(NamedStyle::style)</span>
<span class="fc" id="L113">                    .filter( filter )</span>
<span class="fc" id="L114">                    .collect(Collectors.toList())</span>
                );
    }

    public String toString( String defaultName, String styleType ) {
<span class="fc bfc" id="L119" title="All 2 branches covered.">        if ( this.size() == 1 )</span>
<span class="fc" id="L120">            return this.get(defaultName).toString();</span>
        else
<span class="fc" id="L122">            return this.namedStyles()</span>
<span class="fc" id="L123">                    .stream()</span>
<span class="pc" id="L124">                    .map(e -&gt; e.name() + &quot;: &quot; + e.style())</span>
<span class="fc" id="L125">                    .collect(Collectors.joining(&quot;, &quot;, styleType+&quot;=[&quot;, &quot;]&quot;));</span>
    }

    @Override
    public int hashCode() {
<span class="fc" id="L130">        return Arrays.hashCode(_styles);</span>
    }

    @Override
    public boolean equals( Object obj ) {
<span class="pc bpc" id="L135" title="1 of 2 branches missed.">        if ( obj == null ) return false;</span>
<span class="pc bpc" id="L136" title="1 of 2 branches missed.">        if ( obj == this ) return true;</span>
<span class="pc bpc" id="L137" title="1 of 2 branches missed.">        if ( obj.getClass() != getClass() ) return false;</span>
<span class="fc" id="L138">        NamedStyles&lt;?&gt; rhs = (NamedStyles&lt;?&gt;) obj;</span>
<span class="fc" id="L139">        return Arrays.equals(_styles, rhs._styles);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>