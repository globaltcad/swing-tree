<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SwingTreeInitConfig.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">swing-tree</a> &gt; <a href="index.source.html" class="el_package">swingtree</a> &gt; <span class="el_source">SwingTreeInitConfig.java</span></div><h1>SwingTreeInitConfig.java</h1><pre class="source lang-java linenums">package swingtree;

import swingtree.style.StyleSheet;
import swingtree.threading.EventProcessor;

import java.awt.Font;
import java.util.Objects;
import java.util.Optional;
import java.util.function.Supplier;

/**
 *  An immutable configuration object for {@link SwingTree},
 *  which can be configured using a functional {@link SwingTreeConfigurator} lambda
 *  passed to {@link SwingTree#initialiseUsing(SwingTreeConfigurator)}.
 *  &lt;p&gt;
 *  It allows for the configuration of the default
 *  font, font installation, scaling, event processing and stylesheet.
 */
public final class SwingTreeInitConfig
{
    /**
     *  Defines how the {@link Font}, specified through {@link SwingTreeInitConfig#defaultFont(Font)},
     *  is installed in the {@link javax.swing.UIManager}.
     */
<span class="fc" id="L25">    public enum FontInstallation</span>
    {
        /**
         *  A soft installation will only install the font as the &quot;defaultFont&quot; property
         *  of the {@link javax.swing.UIManager}.
         */
<span class="fc" id="L31">        SOFT,</span>
        /**
         *  A hard installation will install the font as the &quot;defaultFont&quot; property
         *  of the {@link javax.swing.UIManager} and as the default font of all
         *  {@link javax.swing.UIManager} components.
         */
<span class="fc" id="L37">        HARD,</span>
        /**
         *  No installation will be performed.
         */
<span class="fc" id="L41">        NONE</span>
    }

    /**
     *  Defines how the scaling factor for the UI should be determined.
     */
<span class="fc" id="L47">    public enum Scaling</span>
    {
        /**
         *  The scaling will be derived from the default font size.
         */
<span class="fc" id="L52">        FROM_DEFAULT_FONT,</span>
        /**
         *  The scaling will be derived from the system font size.
         */
<span class="fc" id="L56">        FROM_SYSTEM_FONT,</span>
<span class="fc" id="L57">        FROM_SCALING_FACTOR,</span>
        /**
         *  No scaling will be performed.
         */
<span class="fc" id="L61">        NONE</span>
    }

    public static SwingTreeInitConfig standard() {
<span class="fc" id="L65">        return new SwingTreeInitConfig(</span>
                        null,
                        FontInstallation.SOFT,
                        EventProcessor.COUPLED_STRICT,
<span class="fc" id="L69">                        StyleSheet.none(),</span>
<span class="fc" id="L70">                        SystemProperties.parseScaleFactor(System.getProperty( SystemProperties.UI_SCALE )),</span>
<span class="fc" id="L71">                        SystemProperties.getBoolean( SystemProperties.UI_SCALE_ENABLED, true ),</span>
<span class="fc" id="L72">                        SystemProperties.getBoolean( SystemProperties.UI_SCALE_ALLOW_SCALE_DOWN, false )</span>
                    );
    }


    private final Font             _defaultFont; // may be null
    private final FontInstallation _fontInstallation;
    private final EventProcessor   _eventProcessor;
    private final StyleSheet       _styleSheet;
    private final float            _uiScale;
    private final boolean          _uiScaleEnabled;
    private final boolean          _uiScaleAllowScaleDown;


    private SwingTreeInitConfig(
            Font             defaultFont,
            FontInstallation fontInstallation,
            EventProcessor   eventProcessor,
            StyleSheet       styleSheet,
            float            uiScale,
            boolean          uiScaleEnabled,
            boolean          uiScaleAllowScaleDown
<span class="fc" id="L94">    ) {</span>
<span class="fc" id="L95">        _defaultFont           = defaultFont;</span>
<span class="fc" id="L96">        _fontInstallation      = Objects.requireNonNull(fontInstallation);</span>
<span class="fc" id="L97">        _eventProcessor        = Objects.requireNonNull(eventProcessor);</span>
<span class="fc" id="L98">        _styleSheet            = Objects.requireNonNull(styleSheet);</span>
<span class="fc" id="L99">        _uiScale               = uiScale;</span>
<span class="fc" id="L100">        _uiScaleEnabled        = uiScaleEnabled;</span>
<span class="fc" id="L101">        _uiScaleAllowScaleDown = uiScaleAllowScaleDown;</span>
<span class="fc" id="L102">    }</span>

    /**
     *  Returns an {@link Optional} containing the default font
     *  or an empty {@link Optional} if no default font is set.
     */
    Optional&lt;Font&gt; defaultFont() {
<span class="fc" id="L109">        return Optional.ofNullable(_defaultFont);</span>
    }

    /**
     *  Returns the {@link FontInstallation} mode.
     */
    FontInstallation fontInstallation() {
<span class="fc" id="L116">        return _fontInstallation;</span>
    }

    /**
     *  Returns the {@link Scaling} mode.
     */
    Scaling scalingStrategy() {
<span class="pc bpc" id="L123" title="1 of 2 branches missed.">        if ( !_uiScaleEnabled )</span>
<span class="nc" id="L124">            return Scaling.NONE;</span>
<span class="pc bpc" id="L125" title="1 of 2 branches missed.">        if ( _uiScale &gt; 0 )</span>
<span class="nc" id="L126">            return Scaling.FROM_SCALING_FACTOR;</span>
<span class="fc bfc" id="L127" title="All 2 branches covered.">        if ( _defaultFont != null )</span>
<span class="fc" id="L128">            return Scaling.FROM_DEFAULT_FONT;</span>

<span class="fc" id="L130">        return Scaling.FROM_SYSTEM_FONT;</span>
    }

    /**
     *  Returns the {@link EventProcessor}.
     */
    EventProcessor eventProcessor() {
<span class="fc" id="L137">        return _eventProcessor;</span>
    }

    /**
     *  Returns an {@link Optional} containing the {@link StyleSheet}
     *  or an empty {@link Optional} if no {@link StyleSheet} is set.
     */
    StyleSheet styleSheet() {
<span class="fc" id="L145">        return _styleSheet;</span>
    }

    /**
     *  Returns the UI scaling factor as is specified by the system property {@code swingtree.uiScale}.
     */
    float uiScaleFactor() {
<span class="fc" id="L152">        return _uiScale;</span>
    }

    /**
     *  Returns whether the UI scaling mode is enabled as is specified by the system property {@code swingtree.uiScale.enabled}.
     */
    boolean isUiScaleFactorEnabled() {
<span class="fc" id="L159">        return _uiScaleEnabled;</span>
    }

    /**
     *  Returns whether values smaller than 100% are allowed for the user scale factor
     *  as is specified by the system property {@code swingtree.uiScale.allowScaleDown}.
     */
    boolean isUiScaleDownAllowed() {
<span class="fc" id="L167">        return _uiScaleAllowScaleDown;</span>
    }

    /**
     *  Used to configure the default font, which may be used by the {@link SwingTree}
     *  to derive the UI scaling factor and or to install the font in the {@link javax.swing.UIManager}
     *  depending on the {@link FontInstallation} mode (see {@link #defaultFont(Font, FontInstallation)}).
     * @param newDefaultFont The new default font, or {@code null} to unset the default font.
     * @return A new {@link SwingTreeInitConfig} instance with the new default font.
     */
    public SwingTreeInitConfig defaultFont( Font newDefaultFont ) {
<span class="nc" id="L178">        return new SwingTreeInitConfig(newDefaultFont, _fontInstallation, _eventProcessor, _styleSheet, _uiScale, _uiScaleEnabled, _uiScaleAllowScaleDown);</span>
    }

    /**
     *  Used to configure both the default {@link Font} and the {@link FontInstallation} mode.
     *  &lt;p&gt;
     *  The {@link FontInstallation} mode determines how the {@link Font} is installed
     *  in the {@link javax.swing.UIManager} (see {@link FontInstallation}).
     *  &lt;p&gt;
     *  If the {@link FontInstallation} mode is {@link FontInstallation#SOFT},
     *  then the {@link Font} will only be installed as the &quot;defaultFont&quot; property
     *  in the {@link javax.swing.UIManager}. If on the other hand the {@link FontInstallation}
     *  mode is {@link FontInstallation#HARD}, then the {@link Font} will be installed
     *  by replacing all {@link Font}s in the {@link javax.swing.UIManager}.
     *
     * @param newDefaultFont The new default font, or {@code null} to unset the default font.
     * @param newFontInstallation The new {@link FontInstallation} mode.
     * @return A new {@link SwingTreeInitConfig} instance with the new default font and {@link FontInstallation} mode.
     */
    public SwingTreeInitConfig defaultFont( Font newDefaultFont, FontInstallation newFontInstallation ) {
<span class="fc" id="L198">        return new SwingTreeInitConfig(newDefaultFont, newFontInstallation, _eventProcessor, _styleSheet, _uiScale, _uiScaleEnabled, _uiScaleAllowScaleDown);</span>
    }

    /**
     *  Used to configure the {@link EventProcessor}, which is used to process both
     *  UI and application events.
     *  You may create your own {@link EventProcessor} implementation or use one of the
     *  predefined ones like {@link EventProcessor#COUPLED_STRICT}, {@link EventProcessor#COUPLED}
     *  or {@link EventProcessor#DECOUPLED}.
     *
     * @param newEventProcessor The new {@link EventProcessor}.
     * @return A new {@link SwingTreeInitConfig} instance with the new {@link EventProcessor}.
     */
    public SwingTreeInitConfig eventProcessor( EventProcessor newEventProcessor ) {
<span class="fc" id="L212">        return new SwingTreeInitConfig(_defaultFont, _fontInstallation, newEventProcessor, _styleSheet, _uiScale, _uiScaleEnabled, _uiScaleAllowScaleDown);</span>
    }

    /**
     *  Used to configure a global {@link StyleSheet} serving as a base for all
     *  {@link StyleSheet}s used inside your application (see {@link UI#use(swingtree.style.StyleSheet, Supplier)}).
     *
     * @param newStyleSheet The new {@link StyleSheet}, or {@code null} to unset the {@link StyleSheet}.
     * @return A new {@link SwingTreeInitConfig} instance with the new {@link StyleSheet}.
     */
    public SwingTreeInitConfig styleSheet( StyleSheet newStyleSheet ) {
<span class="fc" id="L223">        return new SwingTreeInitConfig(_defaultFont, _fontInstallation, _eventProcessor, newStyleSheet, _uiScale, _uiScaleEnabled, _uiScaleAllowScaleDown);</span>
    }

    /**
     *  Used to configure the UI scaling factor as is specified by the system property {@code swingtree.uiScale}.
     *  &lt;p&gt;
     *  If Java runtime scales (Java 9 or later), this scale factor is applied on top
     *  of the Java system scale factor. Java 8 does not scale and this scale factor
     *  replaces the user scale factor that SwingTree computes based on the font.
     *  To replace the Java 9+ system scale factor, use system property &quot;sun.java2d.uiScale&quot;,
     *  which has the same syntax as this one.
     *  &lt;p&gt;
     *  &lt;strong&gt;Allowed Values&lt;/strong&gt; e.g. {@code 1.5}, {@code 1.5x}, {@code 150%} or {@code 144dpi} (96dpi is 100%)&lt;br&gt;
     *
     * @param newUiScale The new UI scaling factor.
     * @return A new {@link SwingTreeInitConfig} instance with the new UI scaling factor.
     */
    public SwingTreeInitConfig uiScaleFactor( float newUiScale ) {
<span class="nc" id="L241">        return new SwingTreeInitConfig(_defaultFont, _fontInstallation, _eventProcessor, _styleSheet, newUiScale, _uiScaleEnabled, _uiScaleAllowScaleDown);</span>
    }

    /**
     *  Used to configure whether the UI scaling mode is enabled as is specified by the system property {@code swingtree.uiScale.enabled}.
     *  &lt;p&gt;
     *  &lt;strong&gt;Allowed Values&lt;/strong&gt; {@code false} and {@code true}&lt;br&gt;
     *  &lt;strong&gt;Default&lt;/strong&gt; {@code true}
     *
     * @param newUiScaleEnabled The new UI scaling mode.
     * @return A new {@link SwingTreeInitConfig} instance with the new UI scaling mode.
     */
    public SwingTreeInitConfig isUiScaleFactorEnabled(boolean newUiScaleEnabled ) {
<span class="nc" id="L254">        return new SwingTreeInitConfig(_defaultFont, _fontInstallation, _eventProcessor, _styleSheet, _uiScale, newUiScaleEnabled, _uiScaleAllowScaleDown);</span>
    }

    /**
     *  Used to configure whether values smaller than 100% are allowed for the user scale factor
     *  as is specified by the system property {@code swingtree.uiScale.allowScaleDown}.
     *  &lt;p&gt;
     *  &lt;strong&gt;Allowed Values&lt;/strong&gt; {@code false} and {@code true}&lt;br&gt;
     *  &lt;strong&gt;Default&lt;/strong&gt; {@code false}
     *
     * @param newUiScaleAllowScaleDown The new UI scaling mode.
     * @return A new {@link SwingTreeInitConfig} instance with the new UI scaling mode.
     */
    public SwingTreeInitConfig isUiScaleDownAllowed(boolean newUiScaleAllowScaleDown ) {
<span class="nc" id="L268">        return new SwingTreeInitConfig(_defaultFont, _fontInstallation, _eventProcessor, _styleSheet, _uiScale, _uiScaleEnabled, newUiScaleAllowScaleDown);</span>
    }


    /**
     * Defines/documents own system properties used in SwingTree.
     *
     * @author Daniel Nepp, but originally a derivative work of Karl Tauber
     */
    private static interface SystemProperties
    {
        /**
         * Specifies a custom scale factor used to scale the UI.
         * &lt;p&gt;
         * If Java runtime scales (Java 9 or later), this scale factor is applied on top
         * of the Java system scale factor. Java 8 does not scale and this scale factor
         * replaces the user scale factor that SwingTree computes based on the font.
         * To replace the Java 9+ system scale factor, use system property &quot;sun.java2d.uiScale&quot;,
         * which has the same syntax as this one.
         * &lt;p&gt;
         * &lt;strong&gt;Allowed Values&lt;/strong&gt; e.g. {@code 1.5}, {@code 1.5x}, {@code 150%} or {@code 144dpi} (96dpi is 100%)&lt;br&gt;
         */
        String UI_SCALE = &quot;swingtree.uiScale&quot;;

        /**
         * Specifies whether user scaling mode is enabled.
         * &lt;p&gt;
         * &lt;strong&gt;Allowed Values&lt;/strong&gt; {@code false} and {@code true}&lt;br&gt;
         * &lt;strong&gt;Default&lt;/strong&gt; {@code true}
         */
        String UI_SCALE_ENABLED = &quot;swingtree.uiScale.enabled&quot;;

        /**
         * Specifies whether values smaller than 100% are allowed for the user scale factor
         * (see {@link UI#scale()}).
         * &lt;p&gt;
         * &lt;strong&gt;Allowed Values&lt;/strong&gt; {@code false} and {@code true}&lt;br&gt;
         * &lt;strong&gt;Default&lt;/strong&gt; {@code false}
         */
        String UI_SCALE_ALLOW_SCALE_DOWN = &quot;swingtree.uiScale.allowScaleDown&quot;;

        /**
         * Checks whether a system property is set and returns {@code true} if its value
         * is {@code &quot;true&quot;} (case-insensitive), otherwise it returns {@code false}.
         * If the system property is not set, {@code defaultValue} is returned.
         */
        static boolean getBoolean( String key, boolean defaultValue ) {
<span class="fc" id="L315">            String value = System.getProperty( key );</span>
<span class="pc bpc" id="L316" title="1 of 2 branches missed.">            return (value != null) ? Boolean.parseBoolean( value ) : defaultValue;</span>
        }


        /**
         * Similar to sun.java2d.SunGraphicsEnvironment.getScaleFactor(String)
         */
        static float parseScaleFactor( String s ) {
<span class="pc bpc" id="L324" title="1 of 2 branches missed.">            if ( s == null )</span>
<span class="fc" id="L325">                return -1;</span>

<span class="nc" id="L327">            float units = 1;</span>
<span class="nc bnc" id="L328" title="All 2 branches missed.">            if ( s.endsWith( &quot;x&quot; ) )</span>
<span class="nc" id="L329">                s = s.substring( 0, s.length() - 1 );</span>
<span class="nc bnc" id="L330" title="All 2 branches missed.">            else if ( s.endsWith( &quot;dpi&quot; ) ) {</span>
<span class="nc" id="L331">                units = 96;</span>
<span class="nc" id="L332">                s = s.substring( 0, s.length() - 3 );</span>
<span class="nc bnc" id="L333" title="All 2 branches missed.">            } else if ( s.endsWith( &quot;%&quot; ) ) {</span>
<span class="nc" id="L334">                units = 100;</span>
<span class="nc" id="L335">                s = s.substring( 0, s.length() - 1 );</span>
            }

            try {
<span class="nc" id="L339">                float scale = Float.parseFloat( s );</span>
<span class="nc bnc" id="L340" title="All 2 branches missed.">                return scale &gt; 0 ? scale / units : -1;</span>
<span class="nc" id="L341">            } catch( NumberFormatException ex ) {</span>
<span class="nc" id="L342">                return -1;</span>
            }
        }

    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>